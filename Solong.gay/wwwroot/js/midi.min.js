!function(n){function kt(){var o,t,f,n=navigator.userAgent,r=navigator.appName,i=""+parseFloat(navigator.appVersion),e=parseInt(navigator.appVersion,10),u;return(t=n.indexOf("Opera"))!=-1?(r="Opera",i=n.substring(t+6),(t=n.indexOf("Version"))!=-1&&(i=n.substring(t+8))):(t=n.indexOf("MSIE"))!=-1?(r="Microsoft Internet Explorer",i=n.substring(t+5)):(t=n.indexOf("Trident"))!=-1?(r="Microsoft Internet Explorer",i=(t=n.indexOf("rv:"))!=-1?n.substring(t+3):"0.0"):(t=n.indexOf("Chrome"))!=-1?(r="Chrome",i=n.substring(t+7)):(t=n.indexOf("Android"))!=-1?(r="Android",i=n.substring(t+8)):(t=n.indexOf("Safari"))!=-1?(r="Safari",i=n.substring(t+7),(t=n.indexOf("Version"))!=-1&&(i=n.substring(t+8))):(t=n.indexOf("Firefox"))!=-1?(r="Firefox",i=n.substring(t+8)):(o=n.lastIndexOf(" ")+1)<(t=n.lastIndexOf("/"))&&(r=n.substring(o,t),i=n.substring(t+1),r.toLowerCase()==r.toUpperCase()&&(r=navigator.appName)),(f=i.indexOf(";"))!=-1&&(i=i.substring(0,f)),(f=i.indexOf(" "))!=-1&&(i=i.substring(0,f)),(f=i.indexOf(")"))!=-1&&(i=i.substring(0,f)),e=parseInt(""+i,10),isNaN(e)&&(i=""+parseFloat(navigator.appVersion),e=parseInt(navigator.appVersion,10)),u={},u.browserName=r,u.fullVersion=i,u.majorVersion=e,u.appName=navigator.appName,u.userAgent=navigator.userAgent,u.platform=navigator.platform,u}function ft(n,t){for(var e,u,f,r=0;r<document.scripts.length;r++)if(e=document.scripts[r].src,w==e)return b?void t():(u=newjs.onload,newjs.onreadystatechange=function(){"loaded"!==newjs.readyState&&"complete"!==newjs.readyState||(newjs.onreadystatechange=null,b=!0,u(),t())},void(newjs.onload=function(){b=!0;u();t()}));f=document.getElementsByTagName("script")[0];newjs=document.createElement("script");newjs.onreadystatechange=function(){"loaded"!==newjs.readyState&&"complete"!==newjs.readyState||(newjs.onreadystatechange=null,b=!0,t())};newjs.onload=function(){b=!0;t()};newjs.onerror=function(){i("Error: Cannot load  JavaScript file "+n)};newjs.src=n;newjs.type="text/javascript";f.parentNode.insertBefore(newjs,f)}function et(n){if(rt=Module.ccall("mid_song_read_wave","number",["number","number","number","number"],[f,y,2*u,d]),0==rt)return void lt();for(var r=Math.pow(2,15),i=0;i<u;i++)n.outputBuffer.getChannelData(0)[i]=i<rt?Module.getValue(y+2*i,"i16")/r:0;0==e&&(e=t.currentTime)}function dt(n,e,o){var c=new XMLHttpRequest;c.open("GET",e+o,!0);c.responseType="arraybuffer";c.onerror=function(){i("Error: Cannot retrieve patch file "+e+o)};c.onload=function(){if(200!=c.status)return void i("Error: Cannot retrieve patch file "+e+o+" : "+c.status);if(h--,FS.createDataFile("pat/",o,new Int8Array(c.response),!0,!0),MIDIjs.message_callback&&h>0&&MIDIjs.message_callback("Instruments to be loaded: "+h),i("Instruments to be loaded: "+h),0==h){var l=Module.ccall("mid_istream_open_mem","number",["number","number","number"],[p,v.length,!1]),a=Module.ccall("mid_create_options","number",["number","number","number","number"],[t.sampleRate,32784,1,2*u]);f=Module.ccall("mid_song_load","number",["number","number"],[l,a]);Module.ccall("mid_istream_close","number",["number"],[l]);Module.ccall("mid_song_start","void",["number"],[f]);r=t.createScriptProcessor(u,0,1);y=Module._malloc(2*u);r.onaudioprocess=et;r.connect(t.destination);s=setInterval(tt,g);MIDIjs.message_callback&&MIDIjs.message_callback("Playing: "+n);i("Playing: "+n+" ...")}};c.send()}function nt(n){var t=new XMLHttpRequest;t.open("GET",n,!0);t.responseType="arraybuffer";t.onerror=function(){i("Error: Cannot preload file "+n)};t.onload=function(){200!=t.status};t.send()}function tt(){var n={};n.time=0!=e?t.currentTime-e:0;MIDIjs.player_callback&&MIDIjs.player_callback(n)}function gt(){t&&t.suspend()}function ot(){if(t&&t.resume)return t.resume()}function ni(n){at();d=!1;u=bt;st(n)}function st(n){t||(window.AudioContext=window.AudioContext||window.webkitAudioContext,t=new AudioContext);t.resume?t.resume().then(ht(n)):ht(n)}function ht(n){e=0;tt();i("Loading libtimidity ... ");ft(w,function(){ct(n,ti,null)})}function ct(n,t,r){var o,e,f,u;if(-1!=n.indexOf("data:")){for(o=n.indexOf(",")+1,e=atob(n.substring(o)),v=new Uint8Array(new ArrayBuffer(e.length)),f=0;f<e.length;f++)v[f]=e.charCodeAt(f);return t("data:audio/x-midi ...",v,r)}i("Loading MIDI file "+n+" ...");r||MIDIjs.message_callback("Loading MIDI file "+n+" ...");u=new XMLHttpRequest;u.open("GET",n,!0);u.responseType="arraybuffer";u.onerror=function(){i("Error: Cannot retrieve MIDI file "+n)};u.onload=function(){if(200!=u.status)return void i("Error: Cannot retrieve MIDI file "+n+" : "+u.status);i("MIDI file loaded: "+n);v=new Int8Array(u.response);return t(n,v,r)};u.send()}function ti(n,e){var o,a;p=Module._malloc(e.length);Module.writeArrayToMemory(e,p);rval=Module.ccall("mid_init","number",[],[]);var l=Module.ccall("mid_istream_open_mem","number",["number","number","number"],[p,e.length,!1]),v=Module.ccall("mid_create_options","number",["number","number","number","number"],[t.sampleRate,32784,1,2*u]);if(f=Module.ccall("mid_song_load","number",["number","number"],[l,v]),rval=Module.ccall("mid_istream_close","number",["number"],[l]),h=Module.ccall("mid_song_get_num_missing_instruments","number",["number"],[f]),0<h)for(o=0;o<h;o++)a=Module.ccall("mid_song_get_missing_instrument","string",["number","number"],[f,o]),dt(n,c+"pat/",a);else Module.ccall("mid_song_start","void",["number"],[f]),r=t.createScriptProcessor(u,0,1),y=Module._malloc(2*u),r.onaudioprocess=et,r.connect(t.destination),s=setInterval(tt,g),MIDIjs.message_callback&&MIDIjs.message_callback("Playing: "+n),i("Playing: "+n+" ...")}function ii(n,t,i){d||(d=!0,u=si,st(c+"../midi/initsynth.midi"));0!=f&&Module.ccall("mid_song_note_on","void",["number","number","number","number"],[f,n,t,i])}function ri(){MIDIjs.noteOn(0,60,0)}function lt(){r&&(r.disconnect(),r.onaudioprocess=0,r=0);f&&(Module._free(y),Module._free(p),Module.ccall("mid_song_free","void",["number"],[f]),f=0)}function at(){lt();clearInterval(s);i(l)}function ui(n){return"undefined"==typeof k&&(k=document.createElement("a")),k.href=n,k.href}function it(n){if(n.indexOf("http:")!=-1)return n;var t=ui(n);return t.replace("https:","http:")}function vt(){var n={};0==e&&(e=(new Date).getTime());n.time=((new Date).getTime()-e)/1e3;MIDIjs.player_callback&&MIDIjs.player_callback(n)}function yt(n){pt();url=it(n);var t=document.getElementById("scorioMIDI");t?t.lastChild.setAttribute("src",url):(t=document.createElement("div"),t.setAttribute("id","scorioMIDI"),t.innerHTML='&nbsp;<bgsound src="'+url+'" volume="0"/>',document.body&&document.body.appendChild(t));s=setInterval(vt,g);e=0;r=t;i("Playing "+url+" ...")}function pt(){if(r){var n=r;n.lastChild.setAttribute("src",it(c)+"silence.mid");clearInterval(s);r=0}i(l)}function fi(n){wt();var t=document.getElementById("scorioMIDI");t?t.lastChild.setAttribute("data",n):(t=document.createElement("div"),t.setAttribute("id","scorioMIDI"),t.innerHTML='<object data="'+n+'" autostart="true" volume="0" type="audio/mid"><\/object>',document.body&&document.body.appendChild(t));s=setInterval(vt,g);e=0;r=t;i("Playing "+n+" ...")}function wt(){if(r){var n=r;n.parentNode.removeChild(n);clearInterval(s);r=0}i(l)}function ei(n,t,i){var r=Module._malloc(t.length);Module.writeArrayToMemory(t,r);var f=(Module.ccall("mid_init","number",[],[]),Module.ccall("mid_istream_open_mem","number",["number","number","number"],[r,t.length,!1])),o=Module.ccall("mid_create_options","number",["number","number","number","number"],[44100,32784,1,2*u]),e=Module.ccall("mid_song_load","number",["number","number"],[f,o]),s=(Module.ccall("mid_istream_close","number",["number"],[f]),Module.ccall("mid_song_get_total_time","number",["number"],[e])/1e3);Module.ccall("mid_song_free","void",["number"],[e]);Module._free(r);i&&i(s)}function oi(){for(var t,i,n=0;n<document.scripts.length;n++)if(t=document.scripts[n].src,i=t.lastIndexOf("/midi.js"),i==t.length-8)return t.substr(0,i+1);return null}function i(n){ut&&console.log(n)}var o;try{n.MIDIjs={};n.MIDIjs.initError="initializing ...";var a,y,p,v,w,k,s,t=null,r=0,si=512,bt=8192,u=bt,h=0,rt=0,f=0,c="",e=0,l="",d=!1,ut=!1,g=100,b=!1;c=oi();w=c+"libtimidity.js";o=kt();try{("iPhone"==o.platform||"iPod"==o.platform||"iPad"==o.platform)&&o.majorVersion<=6?a="none":(window.AudioContext=window.AudioContext||window.webkitAudioContext,t=new AudioContext,a="WebAudioAPI")}catch(ci){a="Microsoft Internet Explorer"==o.browserName?"bgsound":"Android"==o.browserName?"none":"object"}n.MIDIjs.set_logging=function(n){ut=n};n.MIDIjs.get_loggging=function(){return ut};n.MIDIjs.player_callback=function(){};n.MIDIjs.message_callback=function(){};n.MIDIjs.get_audio_status=function(){return l};n.MIDIjs.get_duration=function(n,t){"Microsoft Internet Explorer"==o.browserName&&o.fullVersion<10?t&&t(-1):ft(w,function(){ct(n,ei,t)})};n.MIDIjs.pause=function(){};n.MIDIjs.resume=function(){};n.MIDIjs.resumeWebAudioContext=function(){};"WebAudioAPI"==a?(n.MIDIjs.resumeWebAudioContext=ot,n.MIDIjs.pause=gt,n.MIDIjs.resume=ot,n.MIDIjs.play=ni,n.MIDIjs.stop=at,l="audioMethod: WebAudioAPI, sampleRate (Hz): "+t.sampleRate+", audioBufferSize (Byte): "+u,n.MIDIjs.noteOn=ii,n.MIDIjs.startSynth=ri):"bgsound"==a?(n.MIDIjs.play=yt,n.MIDIjs.stop=pt,l="audioMethod: &lt;bgsound&gt;"):"object"==a?(n.MIDIjs.play=fi,n.MIDIjs.stop=wt,l="audioMethod: &lt;object&gt;"):(n.MIDIjs.play=function(){},n.MIDIjs.stop=function(){},l="audioMethod: No method found");"Microsoft Internet Explorer"==o.browserName&&"https:"==location.protocol.toLowerCase()&&setTimeout(function(){yt(it(c)+"silence.mid");clearInterval(s)},1);-1==location.href.indexOf("scorio.com")&&-1==location.href.indexOf("weblily.net")&&-1==location.href.indexOf("local")||"WebAudioAPI"==a&&(nt(c+"pat/arachno-127.pat"),nt(c+"pat/MT32Drums/mt32drum-41.pat"),nt(w));n.MIDIjs.initError=null}catch(hi){n.MIDIjs={};n.MIDIjs.initError=hi}}(this);